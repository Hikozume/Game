using System;
using System.Collections.Generic;

namespace TodoApplication
{
    public class ListModel<TItem>
    {
        public List<TItem> Items { get; }
        public int Limit;
        public int Count;
        public LimitedSizeStack<TItem> stack;
        public LimitedSizeStack<string> whatHappend;
        public LimitedSizeStack<int> idx;


        public ListModel(int limit)
        {
            Items = new List<TItem>();
            Limit = limit;
            stack = new LimitedSizeStack<TItem>(limit);
            whatHappend = new LimitedSizeStack<string>(limit);
            idx = new LimitedSizeStack<int>(limit);
        }

        public void AddItem(TItem item)
        {
            Items.Add(item);
            stack.Push(item);
            whatHappend.Push("AddItem");
            idx.Push(Items.IndexOf(item));
            Count = stack.Count;
        }

        public void RemoveItem(int index)
        {
            stack.Push(Items[index]);
            whatHappend.Push("RemoveItem");
            Count = stack.Count;
            idx.Push(index);
            Items.RemoveAt(index);
        }

        public bool CanUndo()
        {
            if (Count != 0) return true;
            else return false;
        }

        public void Undo()
        {
            var item = stack.Pop();
            var Happens = whatHappend.Pop();
            //var index = Items.IndexOf(item);
            Count = stack.Count;
            if (Happens == "AddItem")
            {
                Items.RemoveAt(Items.IndexOf(item));
            }
            if (Happens == "RemoveItem")
            {
                Items.Insert(idx.Pop() ,item);
            }
        }
    }
}
